<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pick3 Predictions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://js.stripe.com/v3"></script>
    <style>
      body { font-family: system-ui, Arial; max-width: 800px; margin: 40px auto; padding: 0 16px; }
      .plans { display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
      .plan { border: 2px solid #e0e0e0; padding: 20px; border-radius: 8px; flex: 1; min-width: 200px; text-align: center; }
      .plan.free { border-color: #4CAF50; }
      .plan.vip { border-color: #2196F3; }
      .plan.yearly { border-color: #FF9800; }
      button { padding: 12px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 4px; width: 100%; margin-top: 10px; }
      .btn-free { background: #4CAF50; color: white; }
      .btn-vip { background: #2196F3; color: white; }
      .btn-yearly { background: #FF9800; color: white; }
      .user-status { background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
      .vip-features { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 20px; }
    </style>
  </head>
  <body>
    <h1>Pick3 Predictions</h1>
    
    {% if user %}
      <div class="user-status">
        <p>Signed in as <strong>{{ user.email or user['email'] }}</strong> â€” 
           <a href="/account">Account</a> â€” 
           <a href="/logout">Log out</a>
        </p>
        {% if user.status in ['active','trialing'] and user.plan in ['vip_monthly','vip_yearly'] %}
          <h3>ðŸŽ‰ Welcome VIP!</h3>
          <p>You're subscribed to <strong>VIP Pro</strong> - enjoy full access to all features!</p>
          <p><a href="/api/v1/smartscore">Try SmartScore API</a></p>
        {% elif user.plan == 'free' %}
          <h3>ðŸŸ¢ Free Starter Active</h3>
          <p>You're on the free plan. Upgrade to VIP for full features!</p>
        {% endif %}
      </div>
    {% else %}
      <div class="user-status">
        <p><a href="/login">Sign in</a> to access your account and manage subscriptions</p>
      </div>
    {% endif %}
    
    <p>Choose your plan to get started with daily Pick 3 predictions.</p>
    
    <div class="plans">
      <div class="plan free">
        <h3>ðŸŸ¢ Free Starter</h3>
        <p><strong>$0/month</strong></p>
        <p>Daily Pick 3 doubles predictions. Limited features â€” no SmartScore, no singles, no history. Perfect for getting started.</p>
        <button class="btn-free" onclick="subscribe('free')">Get Free Access</button>
      </div>
      
      <div class="plan vip">
        <h3>ðŸ”µ VIP Pro</h3>
        <p><strong>$9.99/month</strong></p>
        <p>Unlock doubles + singles predictions, SmartScoreâ„¢ accuracy ranking, hot/cold digit analysis, and advanced filters.</p>
        <button class="btn-vip" onclick="subscribe('vip_monthly')">Join VIP Monthly</button>
      </div>
      
      <div class="plan yearly">
        <h3>ðŸŸ¡ VIP Pro Yearly</h3>
        <p><strong>$99/year</strong></p>
        <p><strong>Best Value!</strong> Get 12 months for the price of 10. All VIP features included. Save $20!</p>
        <button class="btn-yearly" onclick="subscribe('vip_yearly')">Join VIP Yearly</button>
      </div>
    </div>
    
    <div class="vip-features">
      <h4>ðŸ”µ VIP Features Include:</h4>
      <ul>
        <li>Daily doubles + singles predictions</li>
        <li>SmartScoreâ„¢ accuracy ranking</li>
        <li>Hot/cold digit trends</li>
        <li>Advanced filters and history</li>
        <li>Future Pick 4/5 predictions</li>
        <li>Ad-free experience</li>
      </ul>
    </div>
    
    <p><a href="/privacy">Privacy</a> â€¢ <a href="/terms">Terms</a></p>

    <script>
      const stripe = Stripe("{{ publishable_key }}");
      
      async function subscribe(plan) {
        const res = await fetch(`/create-checkout-session/${plan}`, { method: "POST" });
        const data = await res.json();
        if (data.id) {
          const r = await stripe.redirectToCheckout({ sessionId: data.id });
          if (r.error) alert(r.error.message);
        } else {
          alert(data.error || "Error creating checkout session");
        }
      }
    </script>
  </body>
</html>